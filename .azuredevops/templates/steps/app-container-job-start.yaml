---

parameters:
  - name: serviceConnection
    type: string
  - name: targetSubscriptionId
    type: string
  - name: resourceGroupName
    type: string
  - name: jobName
    type: string

steps:
  - task: AzureCLI@2
    name: apply_database_changes
    displayName: Apply database changes
    inputs:
      azureSubscription: ${{ parameters.serviceConnection }}
      addSpnToEnvironment: true
      failOnStandardError: false
      scriptType: bash
      scriptLocation: inlineScript
      inlineScript: |
        # Exit immediately if a command exits with a non-zero status
        set -eo pipefail

        az account set -s ${{ parameters.targetSubscriptionId }}

        az containerapp job start \
          --name ${{ parameters.jobName }} \
          --resource-group ${{ parameters.resourceGroupName }}
